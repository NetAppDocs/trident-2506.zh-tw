---
sidebar: sidebar 
permalink: trident-use/trident-fsx-examples.html 
keywords: map backends, storage classes, trident backend, ontap-nas, ontap-nas-economy, ontap-nas-flexgroups, options, storageclasses, fsx 
summary: 了解Amazon FSx for ONTAP的後端設定選項。本節提供後端設定範例。 
---
= FSx for ONTAP設定選項和範例
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
了解Amazon FSx for ONTAP的後端設定選項。本節提供後端設定範例。



== 後端配置選項

請參閱下表以了解後端配置選項：

[cols="3"]
|===
| 範圍 | 描述 | 例子 


| `version` |  | 始終為 1 


| `storageDriverName` | 儲存驅動程式的名稱 | `ontap-nas`， `ontap-nas-economy` ， `ontap-nas-flexgroup` ， `ontap-san` ， `ontap-san-economy` 


| `backendName` | 自訂名稱或儲存後端 | 驅動程式名稱 + "_" + dataLIF 


| `managementLIF` | 叢集或 SVM 管理 LIF 的 IP 位址可以指定完全限定網域名稱 (FQDN)。如果Trident安裝時使用了 IPv6 標誌，則可以設定為使用 IPv6 位址。  IPv6 位址必須用方括號定義，例如 [28e8:d9fb:a825:b7bf:69a8:d02f:9e7b:3555]。 | "10.0.0.1", "[2001:1234:abcd::fefe]" 


| `dataLIF` | LIF協定的IP位址。 * ONTAP NAS 驅動程式*： NetApp建議指定 dataLIF。如果未提供， Trident將從 SVM 取得 dataLIF。您可以指定一個完全限定網域名稱 (FQDN) 用於 NFS 掛載操作，從而建立輪詢 DNS 以在多個 dataLIF 之間進行負載平衡。初始設定後可以更改。參考。  * ONTAP SAN 驅動程式*：不要為 iSCSI 指定。 Trident使用ONTAP選擇性 LUN 對應來發現建立多路徑會話所需的 iSCI LIF。如果明確定義了 dataLIF，則會產生警告。如果Trident安裝時使用了 IPv6 標誌，則可以設定為使用 IPv6 位址。  IPv6 位址必須用方括號定義，例如 [28e8:d9fb:a825:b7bf:69a8:d02f:9e7b:3555]。 |  


| `autoExportPolicy` | 啟用自動匯出策略建立和更新 [布林值]。使用 `autoExportPolicy`和 `autoExportCIDRs`選用功能包括： Trident可以自動管理出口策略。 | `false` 


| `autoExportCIDRs` | 用於過濾 Kubernetes 節點 IP 的 CIDR 列表 `autoExportPolicy`已啟用。使用 `autoExportPolicy`和 `autoExportCIDRs`選用功能包括： Trident可以自動管理出口策略。 | "["0.0.0.0/0", "::/0"]" 


| `labels` | 若要套用於磁碟區的任意 JSON 格式標籤集 | “” 


| `clientCertificate` | 用戶端憑證的 Base64 編碼值。用於基於憑證的身份驗證 | “” 


| `clientPrivateKey` | 客戶端私鑰的 Base64 編碼值。用於基於憑證的身份驗證 | “” 


| `trustedCACertificate` | 受信任 CA 憑證的 Base64 編碼值。選修的。用於基於憑證的身份驗證。 | “” 


| `username` | 連接到叢集或 SVM 的使用者名稱。用於基於憑證的身份驗證。例如，vsadmin。 |  


| `password` | 連接叢集或SVM的密碼。用於基於憑證的身份驗證。 |  


| `svm` | 使用的儲存虛擬機 | 如果指定了 SVM 管理 LIF，則派生出該 LIF。 


| `storagePrefix` | 在 SVM 中配置新磁碟區時所使用的前綴。創建後無法修改。要更新此參數，您需要建立一個新的後端。 | `trident` 


| `limitAggregateUsage` | *請勿指定用於Amazon FSx for NetApp ONTAP。 *提供的 `fsxadmin`和 `vsadmin`不包含檢索匯總使用情況和使用Trident限制它所需的權限。 | 請勿使用。 


| `limitVolumeSize` | 如果請求的磁碟區大小大於此值，則配置失敗。此外，它還限制了其管理的 qtree 和 LUN 卷的最大大小，以及 `qtreesPerFlexvol`此選項允許自訂每個FlexVol volume的最大 qtree 數量。 | （預設不強制執行） 


| `lunsPerFlexvol` | 每個 Flexvol 的最大 LUN 數必須在 [50, 200] 範圍內。僅限SAN。 | `100` 


| `debugTraceFlags` | 故障排除時要使用的調試標誌。例如，{"api":false, "method":true} 請勿使用 `debugTraceFlags`除非您正在進行故障排除並且需要詳細的日誌轉儲。 | 無效的 


| `nfsMountOptions` | 以逗號分隔的 NFS 掛載選項清單。 Kubernetes 持久性磁碟區的掛載選項通常在儲存類別中指定，但如果儲存類別中沒有指定掛載選項， Trident將回退到使用儲存後端設定檔中指定的掛載選項。如果在儲存類別或設定檔中未指定任何掛載選項， Trident將不會在關聯的持久性磁碟區上設定任何掛載選項。 | “” 


| `nasType` | 配置 NFS 或 SMB 磁碟區的建立。選項有 `nfs`， `smb`或空值。 *必須設定為 `smb`適用於 SMB 卷。 *設定為 null 則預設使用 NFS 磁碟區。 | `nfs` 


| `qtreesPerFlexvol` | 每個FlexVol 的最大 Qtree 數量必須在 [50, 300] 範圍內 | `200` 


| `smbShare` | 您可以指定以下名稱之一：使用 Microsoft 管理主控台或ONTAP CLI 所建立的 SMB 共用的名稱，或允許Trident建立 SMB 共用的名稱。此參數是Amazon FSx for ONTAP後端所必需的。 | `smb-share` 


| `useREST` | 使用ONTAP REST API 的布林參數。 `useREST`設定為 `true`Trident使用ONTAP REST API 與後端通訊；當設定為 `false`Trident使用 ONTAPI (ZAPI) 呼叫與後端通訊。此功能需要ONTAP 9.11.1 及更高版本。此外，所使用的ONTAP登入角色必須具有存取權限。 `ontapi`應用。預定義項滿足了這一點。 `vsadmin`和 `cluster-admin`角色。從Trident 24.06 版本和ONTAP 9.15.1 或更高版本開始， `useREST`設定為 `true`預設；更改 `useREST`到 `false`使用 ONTAPI (ZAPI) 呼叫。 | `true`適用於ONTAP 9.15.1 或更高版本，否則 `false`。 


| `aws` | 您可以在 AWS FSx for ONTAP的設定檔中指定以下內容： - `fsxFilesystemID` ：指定 AWS FSx 檔案系統的 ID。  - `apiRegion` AWS API 區域名稱。  - `apikey` AWS API 金鑰。  - `secretKey` AWS 金鑰。 | ``
`` 
`""`
`""`
`""` 


| `credentials` | 指定要儲存在 AWS Secrets Manager 中的 FSx SVM 憑證。  - `name` ：包含 SVM 憑證的金鑰的 Amazon 資源名稱 (ARN)。 - `type`設定為 `awsarn`。請參閱link:https://docs.aws.amazon.com/secretsmanager/latest/userguide/create_secret.html["建立 AWS Secrets Manager 金鑰"^]了解更多。 |  
|===


=== 更新 `dataLIF`初始配置後

初始設定完成後，您可以透過執行以下命令來變更 dataLIF，從而為新的後端 JSON 檔案提供更新的 dataLIF。

[source, console]
----
tridentctl update backend <backend-name> -f <path-to-backend-json-file-with-updated-dataLIF>
----

NOTE: 如果 PVC 連接到一個或多個艙體，則必須將所有相應的艙體放下，然後再將它們重新升起，以便新的 dataLIF 生效。



== 用於配置磁碟區的後端配置選項

您可以使用下列選項控制預設配置。 `defaults`配置部分。例如，請參閱下面的設定範例。

[cols="3"]
|===
| 範圍 | 描述 | 預設 


| `spaceAllocation` | LUN 的空間分配 | `true` 


| `spaceReserve` | 空間預留模式；「無」（細）或「大量」（粗） | `none` 


| `snapshotPolicy` | 要使用的快照策略 | `none` 


| `qosPolicy` | 若要為建立的磁碟區指派的 QoS 策略群組。每個儲存池或後端選擇 qosPolicy 或 adaptiveQosPolicy 之一。將 QoS 策略群組與Trident結合使用需要ONTAP 9.8 或更高版本。您應該使用非共享的 QoS 策略群組，並確保該策略群組單獨套用至每個成員。共享的 QoS 策略群組強制規定所有工作負載的總吞吐量上限。 | “” 


| `adaptiveQosPolicy` | 若要為建立的磁碟區指派的自適應 QoS 策略群組。每個儲存池或後端選擇 qosPolicy 或 adaptiveQosPolicy 之一。  ontap-nas-economy 不支援此功能。 | “” 


| `snapshotReserve` | 為快照“0”預留的磁碟區百分比 | 如果 `snapshotPolicy`是 `none`， `else` “” 


| `splitOnClone` | 創建時將克隆體從其母體中分離出來 | `false` 


| `encryption` | 在新磁碟區啟用NetApp磁碟區加密 (NVE)；預設為 `false`。若要使用此選項，必須在叢集上取得 NVE 許可並啟用 NVE。如果後端啟用了 NAE，則在Trident中配置的任何磁碟區都會啟用 NAE。更多信息，請參閱：link:../trident-reco/security-reco.html["Trident如何與 NVE 和 NAE 協同工作"] 。 | `false` 


| `luksEncryption` | 啟用LUKS加密。參考link:../trident-reco/security-reco.html#Use-Linux-Unified-Key-Setup-(LUKS)["使用 Linux 統一金鑰設定 (LUKS)"]。僅限SAN。 | “” 


| `tieringPolicy` | 分層策略的使用	`none` |  


| `unixPermissions` | 新卷模式。  *SMB卷請留空。 * | “” 


| `securityStyle` | 新磁碟區的安全樣式。 NFS 支持 `mixed`和 `unix`安全措施。中小企業支持 `mixed`和 `ntfs`安全措施。 | NFS 預設值為 `unix`。  SMB 預設值為 `ntfs`。 
|===


== 範例配置

.SMB磁碟區的儲存類別配置
[%collapsible]
====
使用 `nasType`， `node-stage-secret-name` ， 和 `node-stage-secret-namespace`您可以指定 SMB 磁碟區並提供所需的 Active Directory 憑證。使用以下方式支援 SMB 卷 `ontap-nas`僅限司機。

[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: nas-smb-sc
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-nas"
  trident.netapp.io/nasType: "smb"
  csi.storage.k8s.io/node-stage-secret-name: "smbcreds"
  csi.storage.k8s.io/node-stage-secret-namespace: "default"
----
====
.使用 Secrets Manager 設定 AWS FSx for ONTAP
[%collapsible]
====
[source, yaml]
----
apiVersion: trident.netapp.io/v1
kind: TridentBackendConfig
metadata:
  name: backend-tbc-ontap-nas
spec:
  version: 1
  storageDriverName: ontap-nas
  backendName: tbc-ontap-nas
  svm: svm-name
  aws:
    fsxFilesystemID: fs-xxxxxxxxxx
  managementLIF:
  credentials:
    name: "arn:aws:secretsmanager:us-west-2:xxxxxxxx:secret:secret-name"
    type: awsarn
----
====